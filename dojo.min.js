dojo={adInit:null,adIsExpanded:false,closeCallback:null,geocoder:null,iosVersion:null,isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return(this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows())
}},isDojo:false,isMraid:false,dojoConsoleLog:false,video_properties:{aspect_ratio:"16:9",attributes:{"webkit-playsinline":false,controls:true,autoplay:true,},container_id:null,close_callback:null,full_screen:false,pause_callback:null,play_callback:null,reload:false,style:{width:"320px",height:"180px",zIndex:5000,margin:0,padding:0,},},videoPlaying:false,videoReload:false,videoInt:null,pl:null,unitID:null,webServiceUrl:"http://lbs.phluant.com/web_services/",dojoUrl:"http://dojo.phluant.com/",ajax:function(e){ajaxRequest=new XMLHttpRequest();
var j="";var c=false;var b=true;var h=this;if(typeof(e.asynch)=="boolean"){b=e.asynch}if(typeof(e.yql)!="undefined"){c=true}if(typeof(e.data)!="undefined"){for(var d in e.data){j+=((j!="")?"&":"")+d+"="+encodeURIComponent(e.data[d])}}if((e.method!="POST"||c)&&j!=""){e.url+=((e.url.indexOf("?")!=-1)?"&":"?")+j}var f=10000;if(typeof(e.timeout)=="number"){f=e.timeout}if(c){var g=((typeof(e.yql.format)=="string")?e.yql.format:"json");var c="format="+g+"&q="+encodeURIComponent("select * from "+g+' where url="'+e.url+'"');
e.url="http://query.yahooapis.com/v1/public/yql";if(e.method!="POST"){e.url+="?"+c}else{j=c}}ajaxRequest.open(e.method,e.url,b);if(e.method=="POST"){ajaxRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");ajaxRequest.send(j)}else{ajaxRequest.send()}if(typeof(e.callback)!="undefined"){var a=setTimeout(function(){ajaxRequest.abort();e.callback({status:"error",reason:"timeout",})},f);ajaxRequest.onreadystatechange=function(){if(ajaxRequest.readyState==4&&ajaxRequest.status==200){clearTimeout(a);
var k=ajaxRequest.responseText;if(typeof(e.js_object)!="undefined"){if(e.js_object){k=ajaxRequest.getResponseHeader("Content-Type").indexOf("xml")!=-1?h.xmlToObject(k,true):JSON.parse(k)}}if(c){k={status:"success",results:k,}}e.callback(k)}else{if(ajaxRequest.status!=200){clearTimeout(a);e.callback({status:"error",request_info:ajaxRequest})}}}}},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},clickthru:function(a){this.dojo_track({type:"click",key:a.name,});window.open(a.url,"_blank")
},contract:function(){if(this.videoPlaying){this.video_close()}if(this.isMraid){mraid.close()}this.dojo_track({type:"interaction",key:"contract",});this.closeCallback()},dojo_track:function(b){if(!this.isDojo||this.dojoConsoleLog){console.log(b.key)}if(this.isDojo){var a=this.dojoUrl+"rmstat?pl="+this.pl+"&adunit="+this.unitID+"&type="+b.type+"&key="+b.key+"&time="+new Date().getTime();this.image_tracker(a)}},expand:function(a){this.dojo_track({type:"interaction",key:"expand",});if(this.isMraid){this.adIsExpanded=true
}},geolocation:function(a){console.log(a);var b={url:this.webServiceUrl+"geolocation/export",method:"GET",callback:a.callback,js_object:true,};if(typeof(a.data)!="undefined"){b.data=a.data}this.ajax(b)},geolocation_prompt:function(b){var a=this;navigator.geolocation.getCurrentPosition(function(c){var d={lat:c.coords.latitude,lng:c.coords.longitude};b.callback(d)},function(c){if(b.failover){a.geolocation(b)}else{b.callback(false)}})},get_stores:function(b){var c={url:this.webServiceUrl+"phluant/export",method:"GET",callback:b.callback,js_object:true,data:{limit:3,dist:30}};
if(typeof(b.data.campaign_id)=="undefined"){console.log("campaign_id is a required attribute for this function");return false}for(var a in b.data){c.data[a]=b.data[a]}c.data.type="get_stores";this.ajax(c)},gid:function(a){return document.getElementById(a)},gmaps_draw:function(c){if(c.map_id===undefined){return console.log("A map id must be specified")}if(typeof(c.map_id)==="string"){c.map_id=this.gid(c.map_id)}var b=new google.maps.Map(c.map_id,{zoom:c.map_zoom,center:new google.maps.LatLng(c.center_lat,c.center_lng),disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP});
var a=new google.maps.LatLngBounds();if(c.markers){c.markers.forEach(function(d){d.position=new google.maps.LatLng(d.lat,d.lng);d.map=b;var e=new google.maps.Marker(d);if(d.clickthru){google.maps.event.addListener(e,"click",function(){if(d.clickthru.callback){d.clickthru.callback()}dojo.dojo_track({type:"click",key:d.clickthru.name,});window.open(d.clickthru.url||"https://maps.google.com/?saddr="+c.user_lat+","+c.user_lng+"&daddr="+this.position.k+","+this.position.A,"_blank")})}a.extend(e.position)
})}if(c.map_zoom===undefined){b.fitBounds(a)}},gmaps_geo:function(c){if(!c.callback){return false}if(!c.loc_type){c.loc_type="address"}if(!this.geocoder){this.geocoder=new google.maps.Geocoder()}var a={};if(["geo","latLng"].indexOf(c.loc_type)!==-1){if(!this.valid_geo(c.address)){return console.error("invalid lat/lng")}var b=c.address.split(",");a.latLng=new google.maps.LatLng(b[0],b[1])}else{a.address=encodeURIComponent(c.address)}this.geocoder.geocode(a,function(e,d){dojo.gmaps_return(e,d,c)})},gmaps_return:function(b,a,d){if(a===google.maps.GeocoderStatus.OK){return d.callback(b)
}else{if(d.failover){var c={data:{value:d.address},callback:d.failover_callback||d.callback,};if(this.valid_zip(d.address)){c.data.type="postal_code"}else{if(this.valid_geo(d.address)){c.data.type="city_postal_by_geo"}else{return console.error("invalid address")}}this.geolocation(c)}else{d.callback(false)}}},image_tracker:function(b){var a=document.createElement("img");a.src=b;a.height="1px";a.width="1px";document.getElementsByTagName("body")[0].appendChild(a)},init:function(d){var h=this;if(typeof(d.callback)=="function"){this.closeCallback=d.callback
}if(typeof(d.init)=="function"){this.adInit=d.init}if(typeof(d.expanded)!="undefined"){if(d.expanded){h.adIsExpanded=true}}if(typeof(mraid)!="undefined"){this.isMraid=true;mraid.setExpandProperties({useCustomClose:true});mraid.addEventListener("stateChange",function(){if(h.adIsExpanded){if(typeof(h.closeCallback)!="null"){h.closeCallback()}h.adIsExpanded=false}});document.body.style.margin="0px";this.container.style.position="absolute";var g=document.createElement("meta");g.name="viewport";g.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0";
document.getElementsByTagName("head")[0].appendChild(g)}if(typeof(d.asynch_load)!="undefined"){var a=d.asynch_load.scripts;var k=d.asynch_load.insert_before;var e=a.length;var b=0;if(typeof(k)=="string"){k=this.gid(k)}var c=k.parentNode;for(var j=0;j<a.length;j++){var f=document.createElement("script");f.src=a[j];c.insertBefore(f,k);f.onload=function(){b++;if(b==e){h.init_check()}}}}else{this.init_check()}},init_check:function(){if(this.adInit!=null){if(this.isMraid){if(mraid.getState()==="loading"){mraid.addEventListener("viewableChange",self.mraid_ready)
}else{this.mraid_ready()}}else{this.adInit()}}},iosVersionCheck:function(){var a=window.navigator.userAgent,b=a.indexOf("OS ");if((a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1)&&b>-1){return window.Number(a.substr(b+3,3).replace("_","."))}return 0},mraid_ready:function(){if(mraid.isViewable()){this.mraid_view_change()}else{mraid.addEventListener("viewableChange",this.mraid_view_change)}},mraid_view_change:function(){if(mraid.isViewable()){if(!this.winLoaded){winLoaded=true;window.dispatchEvent(new Event("load"))
}this.track("viewableChange");setTimeout(this.adInit.bind(this))}},query_string:function(e){var c=window.location.href;if(c.indexOf("?")!=-1){var f=new Object();var b=c.split("?");var g=b[1].split("&");for(var d=0;d<g.length;d++){var a=g[d].split("=");f[a[0]]=decodeURIComponent(a[1])}if(e){f=JSON.stringify(f)}return f}else{return false}},roundIt:function(b,a){var c=1;if(a>0){c=Math.pow(10,a)}return Math.round(b*c)/c},session_import:function(b){for(var a in b){this[a]=b[a]}},shoplocal:function(l){var d={storeid:null,listingcount:50,resultset:"full",sortby:6,listingimagewidth:60,};
for(var q in d){if(typeof(l.data[q])!="undefined"){d[q]=l.data[q]}}var j=null;var e={};var p=this;if(typeof(l.data.call_type)!="undefined"){j=l.data.call_type.split(",");for(var h=0;h<j.length;h++){if(j[h]!="store"){if(typeof(l.data[j[h]+"ids"])=="undefined"){console.error("data."+j[h]+"ids must be defined for the respective lookup.");return false}else{e[j[h]]={};var r=l.data[j[h]+"ids"].split(",");for(var o=0;o<r.length;o++){e[j[h]][r[o]]=null}}}}}var m=["company","campaignid"];for(var h=0;h<m.length;
h++){if(typeof(l.data[m[h]])=="undefined"){console.error("data."+m[h]+" is a required attribute for the shoplocal function.");return false}}var n=null;var g={callback:f,};if(typeof(l.data.location)!="undefined"){if(pcf.valid_zip(l.data.location)){n=l.data.location;a()}else{if(pcf.valid_geo(l.data.location)){g.data={type:"city_postal_by_geo",value:l.data.location}}else{console.error("Invalid location format.  Must be either a US postal code or lat/lng coordinates.  See documentation for more details.");
return false}}}else{pcf.geolocation(g)}function a(){if(d.storeid==null){b()}else{if(j!=null){var v=true;for(var u=0;u<j.length;u++){for(var s in e[j[u]]){if(e[j[u]][s]==null){k(j[u],s);v=false;break}}}if(v){c()}}else{c()}}}function b(){var s={url:"http://api.shoplocal.com/"+l.data.company+"/2012.1/xml/getstores.aspx?campaignid="+l.data.campaignid+"&citystatezip="+n,method:"GET",yql:{format:"xml",},callback:function(y){if(y.status!="error"){var x=p.xmlToObject(y.results,true);var w=x.query.results.content;
var u=w.collection.data;d.storeid=null;for(var v in u){var t=true;if(typeof(l.data.name_flag)!="undefined"&&u[v]["@attributes"].name.indexOf(l.data.name_flag)!=-1){t=false}if(u[v]["@attributes"].contentflag!="Y"){t=false}if(t&&d.storeid==null){d.storeid=u[v]["@attributes"].storeid}if(!t){delete w.collection.data[v]}}e.stores={status:"success",shoplocal_url:this.url,results:w,};a()}},};if(typeof(l.data.pd)!="undefined"){s.url+="&pd="+l.data.pd}pcf.ajax(s)}function k(w,v){var t={url:"http://api.shoplocal.com/target/2012.2/xml/get"+w+"listings.aspx?campaignid="+l.data.campaignid+"&"+w+"ids="+v,method:"GET",yql:{format:"xml",},callback:function(x){if(x.status!="error"){var s=p.xmlToObject(x.results,true);
e[w][v]={status:"success",shoplocal_url:this.url,results:s.query.results.content,};a()}},};for(var u in d){t.url+="&"+u+"="+d[u]}if(typeof(l.data.pd)!="undefined"){t.url+="&pd="+l.data.pd}pcf.ajax(t)}function f(s){if(s.status=="success"){e.user_info=s.results;n=s.results.postal_code;a()}}function c(){l.callback(e)}},track:function(a){this.dojo_track({type:"interaction",key:a,})},valid_email:function(a){var b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return b.test(a)},valid_geo:function(b){passed=true;
b=b.split(",");if(typeof(b)=="object"){for(var a=0;a<b.length;a++){if(isNaN(b[a])){passed=false;break}}}else{passed=false}return passed},valid_phone:function(a){if(a){a=a.replace(/[^0-9]/g,"");return/^\d{10}/.test(zipTest)}},valid_zip:function(a){return/^\d{5}(-\d{4})?$/.test(a)},video:function(g){var d=this;this.videoPlaying=true;if(g){this.videoId=g.container_id}if(typeof(this.videoId)=="string"){this.videoId=this.gid(this.videoId)}objCheck=["style","attributes"];if(!this.videoReload){for(var f in g){if(objCheck.indexOf(f)!=-1){for(var c in g[f]){this.video_properties[f][c]=g[f][c]
}}else{this.video_properties[f]=g[f]}}}if(this.video_properties.full_screen){this.video_properties.attributes["webkit-playsinline"]=false}if(typeof(this.video_properties.container_id)=="string"){this.video_properties.container_id=this.gid(this.video_properties.container_id)}var h=this.video_properties.container_id;var b=this.video_properties.aspect_ratio.split(":");if(this.video_properties.style.width=="0px"&&this.video_properties.style.height=="0px"){console.log("At least a height or a width for the video element or its parent element must be declared");
return false}if(this.video_properties.style.width!="0px"&&this.video_properties.style.height=="0px"){this.video_properties.style.height=this.video_properties.style.width.replace("px","")*(b[1]/b[0])+"px"}if(this.video_properties.style.width=="0px"&&this.video_properties.style.height!="0px"){this.video_properties.style.width=this.video_properties.style.height.replace("px","")*(b[0]/[1])+"px"}var e='<video src="'+this.video_properties.video_url+'"></video>';h.innerHTML=e;dojo_videoElement=h.getElementsByTagName("video")[0];
for(var a in this.video_properties.attributes){if(this.video_properties.attributes[a]===true){dojo_videoElement.setAttribute(a,"")}else{if(this.video_properties.attributes[a]!==false){dojo_videoElement.setAttribute(a,this.video_properties.attributes[a])}}}for(var f in this.video_properties.style){dojo_videoElement.style[f]=this.video_properties.style[f]}dojo_videoElement.addEventListener("play",function(){d.dojo_track({type:"video",key:"play"});if(d.video_properties.full_screen){d.video_full_screen(dojo_videoElement)
}if(typeof(d.video_properties.play_callback)=="function"){d.video_properties.play_callback()}});dojo_videoElement.addEventListener("pause",function(){if(typeof(d.video_properties.pause_callback)=="function"){d.video_properties.pause_callback()}});dojo_videoElement.addEventListener("loadedmetadata",function(){var k={"25":false,"50":false,"75":false,};var j=dojo_videoElement.duration;d.videoInt=setInterval(function(){var l=d.roundIt(((dojo_videoElement.currentTime/j)*100),0);for(var m in k){if(l==m&&!k[m]){d.dojo_track({type:"video",key:"quartile"+m});
k[m]=true}}},100)});if(this.video_properties.attributes.autoplay===true){setTimeout(function(){dojo_videoElement.play()},500)}if(!this.video_properties.full_screen){dojo_videoElement.addEventListener("ended",function(){d.video_close()})}dojo_videoElement.addEventListener("webkitendfullscreen",function(){d.video_close()})},video_close:function(){this.video_properties.container_id.innerHTML="";this.videoPlaying=false;clearInterval(this.videoInt);this.dojo_track({type:"video",key:"videoComplete"});if(typeof(this.video_properties.close_callback)=="function"){this.video_properties.close_callback()
}if(this.video_properties.reload){this.videoReload=true;this.video_properties.attributes.autoplay=false;this.video()}},video_full_screen:function(b){var a=this;var c="endfullscreen";if(b.requestFullscreen){b.requestFullscreen()}else{if(b.mozRequestFullScreen){b.mozRequestFullScreen();c="mozendfullscreen"}else{if(b.webkitRequestFullscreen){b.webkitRequestFullscreen();c="webkitendfullscreen"}else{if(b.msRequestFullscreen){b.msRequestFullscreen();c="msendfullscreen"}}}}b.addEventListener(c,function(){a.video_close()
})},xmlToObject:function(h,d){if(d){var a=new DOMParser();h=a.parseFromString(h,"text/xml")}var f={};if(h.nodeType==1){if(h.attributes.length>0){f["@attributes"]={};for(var e=0;e<h.attributes.length;e++){var b=h.attributes.item(e);f["@attributes"][b.nodeName]=b.nodeValue}}}else{if(h.nodeType==3){f=h.nodeValue}}if(h.hasChildNodes()){for(var g=0;g<h.childNodes.length;g++){var l=h.childNodes.item(g);var k=l.nodeName;if(typeof(f[k])=="undefined"){f[k]=this.xmlToObject(l,false)}else{if(typeof(f[k].push)=="undefined"){var c=f[k];
f[k]=[];f[k].push(c)}f[k].push(this.xmlToObject(l,false))}}}return f},};dojo.iosVersion=dojo.iosVersionCheck();var metas=document.getElementsByTagName("meta");for(var i=0;i<metas.length;i++){if(metas[i].getAttribute("name")=="apple-mobile-web-app-status-bar-style"){dojo.isDojo=true}};