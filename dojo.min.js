dojo={adInit:null,adIsExpanded:false,closeCallback:null,geocoder:null,iosVersion:null,isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return(this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows())
}},isDojo:false,isMraid:false,dojoConsoleLog:false,video_properties:{aspect_ratio:"16:9",attributes:{"webkit-playsinline":false,controls:true,autoplay:true,},container_id:null,close_callback:null,full_screen:false,pause_callback:null,play_callback:null,reload:false,style:{width:"320px",height:"180px",zIndex:5000,margin:0,padding:0,},},videoPlaying:false,videoReload:false,videoInt:null,pl:null,unitID:null,webServiceUrl:"http://lbs.phluant.com/web_services/",dojoUrl:"http://staging.dojo.phluant.com/",ajax:function(e){ajaxRequest=new XMLHttpRequest();
var a="";if(typeof(e.data)!="undefined"){for(var b in e.data){if(a!=""){a+="&"}a+=b+"="+encodeURIComponent(e.data[b])}}if(e.method=="GET"&&a!=""){e.url+="?"+a}var d=10000;if(typeof(e.timeout)=="number"){d=e.timeout}ajaxRequest.open(e.method,e.url,true);if(e.method=="POST"){ajaxRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");ajaxRequest.send(a)}else{ajaxRequest.send()}var c=setTimeout(function(){ajaxRequest.abort();if(typeof(e.callback)!="undefined"){e.callback({status:"timeout",})
}},d);ajaxRequest.onreadystatechange=function(){clearTimeout(c);if(ajaxRequest.readyState==4&&ajaxRequest.status==200){if(typeof(e.js_object)!="undefined"){var f=ajaxRequest.responseText;if(e.js_object){f=JSON.parse(f)}}if(typeof(e.callback)!="undefined"){e.callback(f)}}else{if(typeof(e.callback)!="undefined"){e.callback({status:"error",request_info:ajaxRequest})}}}},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},clickthru:function(a){this.dojo_track({type:"click",key:a.name,});
window.open(a.url,"_blank")},contract:function(){if(this.videoPlaying){this.video_close()}if(this.isMraid){mraid.close()}this.dojo_track({type:"interaction",key:"contract",});this.closeCallback()},dojo_track:function(b){if(!this.isDojo||this.dojoConsoleLog){console.log(b.key)}if(this.isDojo){var a=this.dojoUrl+"rmstat?pl="+this.pl+"&adunit="+this.unitID+"&type="+b.type+"&key="+b.key+"&time="+new Date().getTime();this.image_tracker(a)}},expand:function(a){this.dojo_track({type:"interaction",key:"expand",});
if(this.isMraid){this.adIsExpanded=true}},geolocation:function(b){var c={url:this.webServiceUrl+"geolocation/export",method:"GET",callback:b.callback,js_object:true,};if(typeof(b.data)=="object"){for(var a in b.data){c.data[a]=b.data[a]}}this.ajax(c)},geolocation_prompt:function(b){var a=this;navigator.geolocation.getCurrentPosition(function(c){var d={lat:c.coords.latitude,lng:c.coords.longitude};b.callback(d)},function(c){if(b.failover){a.geolocation(b)}else{b.callback(false)}})},get_stores:function(b){var c={url:this.webServiceUrl+"phluant/export",method:"GET",callback:b.callback,js_object:true,data:{limit:3,dist:30}};
if(typeof(b.data.campaign_id)=="undefined"){console.log("campaign_id is a required attribute for this function");return false}for(var a in b.data){c.data[a]=b.data[a]}c.data.type="get_stores";this.ajax(c)},gid:function(a){return document.getElementById(a)},gmaps_draw:function(l){var h=10;if(typeof(l.map_zoom)!="undefined"){h=l.map_zoom}var c={zoom:h,center:new google.maps.LatLng(l.center_lat,l.center_lng),disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP};if(typeof(l.map_id)=="undefined"){console.log("A map id must be specified");
return false}else{if(typeof(l.map_id)=="string"){l.map_id=this.gid(l.map_id)}}var a=new google.maps.Map(l.map_id,c);if(typeof(l.markers)!="undefined"){for(var f in l.markers){var g=l.markers[f];var e=new google.maps.LatLng(g.lat,g.lng);var d={position:e,map:a,};var k=["lat","lng","clickthru"];for(var b in g){if(k.indexOf(g[b])!=-1){d[b]=g[b]}}var j=new google.maps.Marker(d);if(typeof(g.clickthru)!="undefined"){if(typeof(g.clickthru.url)!="undefined"){j.clickthru=g.clickthru.url}google.maps.event.addListener(j,"click",function(){var m="http://maps.google.com/?saddr="+l.user_lat+","+l.user_lng+"&daddr="+this.position.k+","+this.position.A;
if(typeof(this.clickthru)!="undefined"){m=this.clickthru}dojo.dojo_track({type:"click",key:this.clickthru.name,});window.open(m,"_blank")})}}}},gmaps_geo:function(b){if(this.geocoder==null){this.geocoder=new google.maps.Geocoder()}var a=this;this.geocoder.geocode({address:encodeURIComponent(b.address)},function(e,c){if(c==google.maps.GeocoderStatus.OK){b.callback(e)}else{if(typeof(b.failover)=="boolean"){if(b.failover){var d={};d.callback=b.callback;if(typeof(b.failover_callback)!="undefined"){d.callback=b.failover_callback
}if(this.valid_zip(address)){d.data.type="postal_code"}if(this.valid_geo(address)){d.data.type="city_postal_by_geo"}if(typeof(d.data.type)!="undefined"){d.data.value=b.address}a.geolocation(d)}}else{b.callback(false)}}})},image_tracker:function(b){var a=document.createElement("img");a.src=b;a.height="1px";a.width="1px";document.getElementsByTagName("body")[0].appendChild(a)},init:function(c){var b=this;if(typeof(c.callback)=="function"){this.closeCallback=c.callback}if(typeof(c.init)=="function"){this.adInit=c.init
}if(typeof(c.expanded)!="undefined"){if(c.expanded){b.adIsExpanded=true}}if(typeof(mraid)!="undefined"){if(this.adInit==null){console.log("An initialization function must be set for MRAID to work properly.");return false}if(this.closeCallback==null){console.log("A close function must be set for MRAID to work properly.");return false}this.isMraid=true;mraid.setExpandProperties({useCustomClose:true});mraid.addEventListener("stateChange",function(){if(b.adIsExpanded){if(typeof(b.closeCallback)!="null"){b.closeCallback()
}b.adIsExpanded=false}});document.body.style.margin="0px";this.container.style.position="absolute";var a=document.createElement("meta");a.name="viewport";a.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0";document.getElementsByTagName("head")[0].appendChild(a)}if(this.adInit!=null){if(this.isMraid){if(mraid.getState()==="loading"){mraid.addEventListener("viewableChange",b.mraid_ready)}else{this.mraid_ready()}}else{this.adInit()}}},iosVersionCheck:function(){var a=window.navigator.userAgent,b=a.indexOf("OS ");
if((a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1)&&b>-1){return window.Number(a.substr(b+3,3).replace("_","."))}return 0},mraid_ready:function(){if(mraid.isViewable){this.mraid_change()}else{mraid.addEventListener("viewableChange",this.mraid_change)}},mraid_change:function(){var a=this;if(mraid.isViewable()){mraidResize(currW,currH);setTimeout(function(){a.adInit()},125)}},query_string:function(e){var c=window.location.href;if(c.indexOf("?")!=-1){var f=new Object();var b=c.split("?");var g=b[1].split("&");
for(var d=0;d<g.length;d++){var a=g[d].split("=");f[a[0]]=decodeURIComponent(a[1])}if(e){f=JSON.stringify(f)}return f}else{return false}},roundIt:function(b,a){var c=1;if(a>0){c=Math.pow(10,a)}return Math.round(b*c)/c},session_import:function(b){for(var a in b){this[a]=b[a]}},shoplocal:function(c){var d={url:this.webServiceUrl+"phluant/export",method:"GET",callback:c.callback,js_object:true,data:{call_type:"store",store_limit:1,cat_limit:10}};for(var a in c.data){d.data[a]=c.data[a]}var b=["company","campaign_id"];
for(var a=0;a<b.length;a++){if(typeof(d.data[a])=="undefined"){console.log(b[a]+" is a required attribute for the shoplocal function.");return false}}if(d.data.call_type.indexOf("category")!=-1&&typeof(d.data.category_tree_id)=="undefined"){console.log("category_tree_id must be defined for a shoplocal category lookup.");return false}d.data.type="shoplocal";this.ajax(d)},track:function(a){this.dojo_track({type:"interaction",key:a,})},valid_email:function(a){var b=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
return b.test(a)},valid_geo:function(b){passed=true;b=b.split(",");if(typeof(b)=="object"){for(var a=0;a<b.length;a++){if(isNaN(b[a])){passed=false;break}}}else{passed=false}return passed},valid_phone:function(a){if(a){a=a.replace(/[^0-9]/g,"");return/^\d{10}/.test(zipTest)}},valid_zip:function(a){return/^\d{5}(-\d{4})?$/.test(a)},video:function(f){var c=this;this.videoPlaying=true;this.videoId=f.container_id;if(typeof(this.videoId)=="string"){this.videoId=this.gid(this.videoId)}objCheck=["style","attributes"];
if(!this.videoReload){for(var e in f){if(objCheck.indexOf(e)!=-1){for(var b in f[e]){this.video_properties[e][b]=f[e][b]}}else{this.video_properties[e]=f[e]}}}if(this.video_properties.full_screen){this.video_properties.attributes["webkit-playsinline"]=false}if(typeof(this.video_properties.container_id)=="string"){this.video_properties.container_id=this.gid(this.video_properties.container_id)}var g=this.video_properties.container_id;var a=this.video_properties.aspect_ratio.split(":");if(this.video_properties.style.width=="0px"&&this.video_properties.style.height=="0px"){console.log("At least a height or a width for the video element or its parent element must be declared");
return false}if(this.video_properties.style.width!="0px"&&this.video_properties.style.height=="0px"){this.video_properties.style.height=this.video_properties.style.width.replace("px","")*(a[1]/a[0])+"px"}if(this.video_properties.style.width=="0px"&&this.video_properties.style.height!="0px"){this.video_properties.style.width=this.video_properties.style.height.replace("px","")*(a[0]/[1])+"px"}var d='<video src="'+this.video_properties.video_url+'"></video>';g.innerHTML=d;dojo_videoElement=g.getElementsByTagName("video")[0];
for(var e in this.video_properties.attributes){dojo_videoElement.setAttribute(e,this.video_properties.attributes[e])}for(var e in this.video_properties.style){dojo_videoElement.style[e]=this.video_properties.style[e]}dojo_videoElement.addEventListener("play",function(){if(c.video_properties.full_screen){c.video_full_screen(elem)}if(typeof(c.video_properties.play_callback)=="function"){c.video_properties.play_callback()}});dojo_videoElement.addEventListener("pause",function(){if(typeof(c.video_properties.pause_callback)=="function"){c.video_properties.pause_callback()
}});dojo_videoElement.addEventListener("loadedmetadata",function(){var j={"25":false,"50":false,"75":false,};var h=dojo_videoElement.duration;c.videoInt=setInterval(function(){var k=c.roundIt(((dojo_videoElement.currentTime/h)*100),0);for(var l in j){if(k==l&&!j[l]){c.dojo_track({type:"video",key:"quartile"+l});j[l]=true}}},100)});if(this.video_properties.attributes.autoplay){setTimeout(function(){dojo_videoElement.play();c.dojo_track({type:"video",key:"play"})},500)}if(!this.video_properties.full_screen){dojo_videoElement.addEventListener("ended",function(){c.video_close()
})}dojo_videoElement.addEventListener("webkitendfullscreen",function(){c.video_close()})},video_close:function(){this.video_properties.container_id.innerHTML="";this.videoPlaying=false;clearInterval(this.videoInt);this.dojo_track({type:"video",key:"videoComplete"});if(typeof(this.video_properties.close_callback)=="function"){this.video_properties.close_callback()}if(this.video_properties.reload){this.videoReload=true;this.video_properties.attributes.autoplay=false;this.video()}},video_full_screen:function(b){var a=this;
var c="endfullscreen";if(b.requestFullscreen){b.requestFullscreen()}else{if(b.mozRequestFullScreen){b.mozRequestFullScreen();c="mozendfullscreen"}else{if(b.webkitRequestFullscreen){b.webkitRequestFullscreen();c="webkitendfullscreen"}else{if(b.msRequestFullscreen){b.msRequestFullscreen();c="msendfullscreen"}}}}b.addEventListener(c,function(){a.video_close()})},};dojo.iosVersion=dojo.iosVersionCheck();var metas=document.getElementsByTagName("meta");for(var i=0;i<metas.length;i++){if(metas[i].getAttribute("name")=="apple-mobile-web-app-status-bar-style"){dojo.isDojo=true
}};