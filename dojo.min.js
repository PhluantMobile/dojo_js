(function(){window.dojo={version:"0.3.14",adIsExpanded:false,closeCallback:null,geocoder:null,iosVersion:null,isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},isDojo:false,isMraid:false,winLoaded:false,dojoConsoleLog:false,video_properties:{aspect_ratio:"16:9",attributes:{"webkit-playsinline":false,controls:true,autoplay:true},container_id:null,close_callback:null,full_screen:false,pause_callback:null,play_callback:null,style:{width:"320px",height:"180px",zIndex:5e3,margin:0,padding:0}},videoPlaying:false,videoInt:null,pl:null,unitID:null,webServiceUrl:"http://lbs.phluant.com:8080/",dojoUrl:"http://dojo.phluant.com/",iframeEl:null,iframeContractSize:{},lastInteractionTime:0,pageTimeInterval:undefined,elapsedTime:0,expandedEl:null,useCustomClose:false,closeImg:null,addCloseButton:function(){if(this.closeImg&&this.closeImg.parentElement)return this.closeImg.style.display="block";this.closeImg=new Image;this.closeImg.style.cssText="position: absolute; right:0; top:0; width: 45px;";this.closeImg.classList.add("close");this.closeImg.addEventListener("click",this.contract.bind(this));this.closeImg.src="http://mdn4.phluantmobile.net/jslib/dojo/close.png";if(this.expandedEl)this.expandedEl.appendChild(this.closeImg)},removeCloseButton:function(){this.closeImg.style.display="none"},ajax:function(vars){ajaxRequest=new XMLHttpRequest;var sendData="";var yql=false;var asynch=true;var self=this;if(typeof vars.asynch=="boolean"){asynch=vars.asynch}if(typeof vars.yql!="undefined"){yql=true}if(typeof vars.data!="undefined"){for(var i in vars.data){sendData+=(sendData!=""?"&":"")+i+"="+encodeURIComponent(vars.data[i])}}if((vars.method!="POST"||yql)&&sendData!=""){vars.url+=(vars.url.indexOf("?")!=-1?"&":"?")+sendData}var timeout=1e4;if(typeof vars.timeout=="number"){timeout=vars.timeout}if(yql){var format=typeof vars.yql.format=="string"?vars.yql.format:"json";var yql="format="+format+"&q="+encodeURIComponent("select * from "+format+' where url="'+vars.url+'"');vars.url="http://query.yahooapis.com/v1/public/yql";if(vars.method!="POST"){vars.url+="?"+yql}else{sendData=yql}}ajaxRequest.open(vars.method,vars.url,asynch);if(vars.method=="POST"){ajaxRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");ajaxRequest.send(sendData)}else{ajaxRequest.send()}if(typeof vars.callback!="undefined"){var ajaxTimeout=setTimeout(function(){ajaxRequest.abort();vars.callback({status:"error",reason:"timeout"})},timeout);ajaxRequest.onreadystatechange=function(){if(ajaxRequest.readyState==4&&ajaxRequest.status==200){clearTimeout(ajaxTimeout);var resp=ajaxRequest.responseText;if(typeof vars.js_object!="undefined"){if(vars.js_object){resp=ajaxRequest.getResponseHeader("Content-Type").indexOf("xml")!=-1?self.xmlToObject(resp,true):JSON.parse(resp)}}if(yql){resp={status:"success",results:resp}}vars.callback(resp)}else if(ajaxRequest.status!=200){clearTimeout(ajaxTimeout);vars.callback({status:"error",request_info:ajaxRequest})}}}},capitalize:function(str){return str.charAt(0).toUpperCase()+str.slice(1)},clickthru:function(vars){var tagParams=this.getTagParams();var prepend=tagParams.ClickPrependURL||tagParams.prependclickcontent;var clickthruURL=tagParams.ClickthruURL&&decodeURIComponent(tagParams.ClickthruURL);prepend=prepend&&decodeURIComponent(prepend)&&vars.prepend;this.dojo_track({type:"click",key:vars.name});if(prepend)vars.url=prepend+encodeURIComponent(vars.url);console.log("opening "+vars.url);this.pageTime(false);if(this.isMraid)mraid.open(vars.url);else window.open(vars.url,"_blank")},contract:function(){if(!this.adIsExpanded)return;else this.adIsExpanded=false;if(this.isMraid)mraid.close();if(this.videoPlaying)this.video_close();if(this.iframeEl){this.iframeEl.style.width=this.iframeContractSize.x+"px";this.iframeEl.style.height=this.iframeContractSize.y+"px"}if(!this.isMraid&&!this.useCustomClose)this.removeCloseButton();this.track("contract");this.pageTime(false);if(this.closeCallback)this.closeCallback()},expand:function(width,height){if(this.adIsExpanded)return;if(typeof width==="number")width+="px";if(typeof height==="number")height+="px";if(this.iframeEl){this.iframeContractSize.x=this.iframeEl.offsetWidth;this.iframeContractSize.y=this.iframeEl.offsetHeight;if(width)this.iframeEl.style.width=width;if(height)this.iframeEl.style.height=height}if(this.isMraid)mraid.expand();if(!this.useCustomClose&&!this.isMraid){this.addCloseButton()}this.track("expand");this.adIsExpanded=true;this.pageTime(true)},geolocation:function(vars){console.log(vars);var varsExport={url:this.webServiceUrl+"geolocation/export",method:"GET",callback:vars.callback,js_object:true};if(typeof vars.data!="undefined"){varsExport.data=vars.data}this.ajax(varsExport)},geolocation_prompt:function(vars){var resolved=false;navigator.geolocation.getCurrentPosition(success,error,{enableHighAccuracy:true,timeout:7e3,maximumAge:0});function success(position){if(resolved)return;else resolved=true;vars.callback({lat:position.coords.latitude,lng:position.coords.longitude})}function error(e){if(resolved)return;else resolved=true;if(vars.failover)dojo.geolocation(vars);else vars.callback(false)}setTimeout(error,8e3)},get_stores:function(vars){var varsExport={url:this.webServiceUrl+"phluant/export",method:"GET",callback:vars.callback,js_object:true,data:{limit:3,dist:30}};if(typeof vars.data.campaign_id=="undefined"){console.log("campaign_id is a required attribute for this function");return false}for(var i in vars.data){varsExport.data[i]=vars.data[i]}varsExport.data.type="get_stores";this.ajax(varsExport)},getTagParams:function(){if(!dojo.isDojo)return{};var scripts=document.getElementsByTagName("script");var i=0,tagScript=scripts[0];while(!tagScript.src.match(/dojo.phluant.com\/adj/))tagScript=scripts[++i];if(tagScript.src.indexOf("?")===-1)return{};var params=tagScript.src.slice(tagScript.src.indexOf("?")+1).split("&");var parsedParams={};params.forEach(function(param){var splitParam=param.split("=");parsedParams[splitParam[0]]=splitParam[1]});return parsedParams},gid:function(id){if(id instanceof HTMLElement)return id;else return document.getElementById(id)||document.getElementsByTagName(id)[0]},gmaps_draw:function(vars){if(vars.map_id===undefined)return console.log("A map id must be specified");if(typeof vars.map_id==="string")vars.map_id=this.gid(vars.map_id);var map=new google.maps.Map(vars.map_id,{zoom:vars.map_zoom,center:new google.maps.LatLng(vars.center_lat,vars.center_lng),disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP});var bounds=new google.maps.LatLngBounds;if(vars.markers)vars.markers.forEach(function(marker){marker.position=new google.maps.LatLng(marker.lat,marker.lng);marker.map=map;var gMarker=new google.maps.Marker(marker);if(marker.clickthru)google.maps.event.addListener(gMarker,"click",function(){if(marker.clickthru.callback)marker.clickthru.callback.call(this);if(!marker.clickthru.url)marker.clickthru.url="https://maps.google.com/?saddr="+vars.user_lat+","+vars.user_lng+"&daddr="+this.position.lat()+","+this.position.lng();dojo.clickthru(marker.clickthru)});if(marker.events)for(var event in marker.events)google.maps.event.addListener(gMarker,event,marker.events[event]);bounds.extend(gMarker.position)});if(vars.map_zoom===undefined)map.fitBounds(bounds)},gmaps_geo:function(vars){if(!vars.callback)return false;if(!vars.loc_type)vars.loc_type="address";if(!this.geocoder)this.geocoder=new google.maps.Geocoder;var opts={};if(["geo","latLng"].indexOf(vars.loc_type)!==-1){if(!this.valid_geo(vars.address))return console.error("invalid lat/lng");var coords=vars.address.split(",");opts.latLng=new google.maps.LatLng(coords[0],coords[1])}else opts.address=encodeURIComponent(vars.address);this.geocoder.geocode(opts,function(results,status){dojo.gmaps_return(results,status,vars)})},gmaps_return:function(results,status,vars){if(status===google.maps.GeocoderStatus.OK)return vars.callback(results);else if(vars.failover){var opts={data:{value:vars.address},callback:vars.failover_callback||vars.callback};if(this.valid_zip(vars.address))opts.data.type="postal_code";else if(this.valid_geo(vars.address))opts.data.type="city_postal_by_geo";else return console.error("invalid address");this.geolocation(opts)}else vars.callback(false)},image_tracker:function(url){var self=this;var img=document.createElement("img");img.src=url;img.height="1px";img.width="1px";document.getElementsByTagName("body")[0].appendChild(img)},init:function(vars){this.closeCallback=vars.callback;this.expandedEl=this.gid(vars.expandedEl)||this.gid("expanded");this.useCustomClose=vars.useCustomClose;var self=this;var loadScripts=vars.asynch_load&&vars.async_load.scripts||[];if(typeof mraid==="undefined")loadScripts.push("mraid.js");this.loadAsync(loadScripts,this.initMraid.bind(this,function(){if(self.isMraid)configMraid();if(self.isMraid&&!self.winLoaded){self.winLoaded=true;try{window.dispatchEvent(new Event("load"))}catch(e){var loadEvent=document.createEvent("Event");loadEvent.initEvent("load",true,true);window.dispatchEvent(loadEvent)}}if(vars.expanded||vars.isInterstitial)self.expand();if(vars.init)setTimeout(vars.init())}))},configMraid:function(){var self=this;mraid.addEventListener("stateChange",function(e){if(e==="hidden"||e==="default"&&self.adIsExpanded)self.contract()});mraid.setExpandProperties({useCustomClose:this.useCustomClose})},initMraid:function(callback){this.isMraid=typeof mraid!=="undefined";if(!this.isMraid)return callback();else if(mraid.getState()==="loading")mraid.addEventListener("ready",this.onMraidReady.bind(this,callback));else this.onMraidReady(callback)},onMraidReady:function(callback){if(mraid.isViewable())this.onMraidViewChange(callback);else mraid.addEventListener("viewableChange",this.onMraidViewChange.bind(this,callback))},onMraidViewChange:function(callback){this.log("viewableChange");if(mraid.isViewable()){callback();mraid.removeEventListener("viewableChange",this.onMraidViewChange)}},iosVersionCheck:function(){var agent=window.navigator.userAgent,start=agent.indexOf("OS ");if((agent.indexOf("iPhone")>-1||agent.indexOf("iPad")>-1)&&start>-1){return window.Number(agent.substr(start+3,3).replace("_","."))}return 0},log:function(message){this.dojo_track({type:"Developer",key:message},false)},pageTime:function(shouldStart){var self=this;if(shouldStart){self.elapsedTime=0;self.lastInteractionTime=0;self.pageTimeInterval=window.setInterval(function(){self.elapsedTime+=5;if(self.elapsedTime-self.lastInteractionTime<=60){self.track("time elapsed "+self.elapsedTime+"s",true)}},5e3)}else{window.clearInterval(self.pageTimeInterval)}},query_string:function(jsonConvert){var url=window.location.href;if(url.indexOf("?")!=-1){var urlObj=new Object;var qString=url.split("?");var params=qString[1].split("&");for(var i=0;i<params.length;i++){var result=params[i].split("=");urlObj[result[0]]=decodeURIComponent(result[1])}if(jsonConvert){urlObj=JSON.stringify(urlObj)}return urlObj}else{return false}},roundIt:function(num,round){var roundTo=1;if(round>0){roundTo=Math.pow(10,round)}return Math.round(num*roundTo)/roundTo},loadAsync:function(scripts,callback){if(scripts.length<=0)return callback();var loadCount=0;scripts.forEach(function(src){var script=document.createElement("script");script.type="text/javascript";script.async=true;script.onload=script.onerror=function(){if(++loadCount===scripts.length)callback()};script.src=src;document.getElementsByTagName("head")[0].appendChild(script)})},shoplocal:function(vars){var settings={storeid:null,listingcount:50,resultset:"full",sortby:6,listingimagewidth:60};for(var s in settings){if(typeof vars.data[s]!="undefined"){settings[s]=vars.data[s]}}var callType=null;var returnData={};var self=this;if(typeof vars.data.call_type!="undefined"){callType=vars.data.call_type.split(",");for(var i=0;i<callType.length;i++){if(callType[i]!="store"){if(typeof vars.data[callType[i]+"ids"]=="undefined"){console.error("data."+callType[i]+"ids must be defined for the respective lookup.");return false}else{returnData[callType[i]]={};var tags=vars.data[callType[i]+"ids"].split(",");for(var t=0;t<tags.length;t++){returnData[callType[i]][tags[t]]=null}}}}}var req=["company","campaignid"];for(var i=0;i<req.length;i++){if(typeof vars.data[req[i]]=="undefined"){console.error("data."+req[i]+" is a required attribute for the shoplocal function.");return false}}var citystatezip=null;var geoCall={callback:geoCallback};if(typeof vars.data.location!="undefined"){if(pcf.valid_zip(vars.data.location)){citystatezip=vars.data.location;determineStep()}else if(pcf.valid_geo(vars.data.location)){geoCall.data={type:"city_postal_by_geo",value:vars.data.location}}else{console.error("Invalid location format.  Must be either a US postal code or lat/lng coordinates.  See documentation for more details.");return false}}else{pcf.geolocation(geoCall)}function determineStep(){if(settings.storeid==null){fetchStore()}else if(callType!=null){var proceed=true;for(var i=0;i<callType.length;i++){for(var t in returnData[callType[i]]){if(returnData[callType[i]][t]==null){fetchCall(callType[i],t);proceed=false;break}}}if(proceed){returnInfo()}}else{returnInfo()}}function fetchStore(){var storeInfo={url:"http://api.shoplocal.com/"+vars.data.company+"/2012.1/xml/getstores.aspx?campaignid="+vars.data.campaignid+"&citystatezip="+citystatezip,method:"GET",yql:{format:"xml"},callback:function(d){if(d.status!="error"){var data=self.xmlToObject(d.results,true);var storeData=data.query.results.content;var stores=storeData.collection.data;settings.storeid=null;for(var i in stores){var grab=true;if(typeof vars.data.name_flag!="undefined"&&stores[i]["@attributes"].name.indexOf(vars.data.name_flag)!=-1){grab=false}if(stores[i]["@attributes"].contentflag!="Y"){grab=false}if(grab&&settings.storeid==null){settings.storeid=stores[i]["@attributes"].storeid}if(!grab){delete storeData.collection.data[i]}}returnData.stores={status:"success",shoplocal_url:this.url,results:storeData};determineStep()}}};if(typeof vars.data.pd!="undefined"){storeInfo.url+="&pd="+vars.data.pd}pcf.ajax(storeInfo)}function fetchCall(callType,treeId){var callInfo={url:"http://api.shoplocal.com/target/2012.2/xml/get"+callType+"listings.aspx?campaignid="+vars.data.campaignid+"&"+callType+"ids="+treeId,method:"GET",yql:{format:"xml"},callback:function(d){if(d.status!="error"){var data=self.xmlToObject(d.results,true);returnData[callType][treeId]={status:"success",shoplocal_url:this.url,results:data.query.results.content};determineStep()}}};for(var s in settings){callInfo.url+="&"+s+"="+settings[s]}if(typeof vars.data.pd!="undefined"){callInfo.url+="&pd="+vars.data.pd}pcf.ajax(callInfo)}function geoCallback(d){if(d.status=="success"){returnData.user_info=d.results;citystatezip=d.results.postal_code;determineStep()}}function returnInfo(){vars.callback(returnData)}},track:function(name,isAutoFired){this.dojo_track({type:"interactions",key:name},isAutoFired)},dojo_track:function(vars,isAutoFired){if(!isAutoFired)this.lastInteractionTime=this.elapsedTime;if(!this.isDojo||this.dojoConsoleLog){console.log(vars.key)}if(this.isDojo){var url=this.dojoUrl+"rmstat?pl="+this.pl+"&adunit="+this.unitID+"&type="+encodeURIComponent(vars.type)+"&key="+encodeURIComponent(vars.key)+"&time="+Date.now();this.image_tracker(url)}},valid_email:function(email){var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return filter.test(email)},valid_geo:function(geoTest){passed=true;geoTest=geoTest.split(",");if(typeof geoTest=="object"){for(var i=0;i<geoTest.length;i++){if(isNaN(geoTest[i])){passed=false;break}}}else{passed=false}return passed},valid_phone:function(phone_num){if(phone_num){phone_num=phone_num.replace(/[^0-9]/g,"");return/^\d{10}/.test(zipTest)}},valid_zip:function(zip){return/^\d{5}(-\d{4})?$/.test(zip)},video:function(vars){var self=this;this.videoPlaying=true;objCheck=["style","attributes"];if(!this.vidContainer){for(var i in vars){if(objCheck.indexOf(i)!=-1){for(var v in vars[i]){this.video_properties[i][v]=vars[i][v]}}else{this.video_properties[i]=vars[i]}}}if(vars)this.vidContainer=vars.container_id;if(typeof this.vidContainer=="string"){this.vidContainer=this.gid(this.vidContainer)}if(this.video_properties.full_screen){this.video_properties.attributes["webkit-playsinline"]=false}var ar=this.video_properties.aspect_ratio.split(":");if(this.video_properties.style.width=="0px"&&this.video_properties.style.height=="0px"){console.log("At least a height or a width for the video element or its parent element must be declared");return false}if(this.video_properties.style.width!="0px"&&this.video_properties.style.height=="0px"){this.video_properties.style.height=this.video_properties.style.width.replace("px","")*(ar[1]/ar[0])+"px"}if(this.video_properties.style.width=="0px"&&this.video_properties.style.height!="0px"){this.video_properties.style.width=this.video_properties.style.height.replace("px","")*(ar[0]/[1])+"px"}dojo_videoElement=document.createElement("video");dojo_videoElement.src=this.video_properties.video_url;for(var attr in this.video_properties.attributes){if(this.video_properties.attributes[attr]===true)dojo_videoElement.setAttribute(attr,"");else if(this.video_properties.attributes[attr]!==false)dojo_videoElement.setAttribute(attr,this.video_properties.attributes[attr])}for(var i in this.video_properties.style){dojo_videoElement.style[i]=this.video_properties.style[i]}dojo_videoElement.addEventListener("canplaythrough",function(){if(self.video_properties.attributes.autoplay===true){dojo_videoElement.play()}});this.vidContainer.appendChild(dojo_videoElement);dojo_videoElement.load();var quartiles={};dojo_videoElement.addEventListener("play",function(){self.dojo_track({type:"video",key:"play"});if(hasEnded){hasEnded=false;quartiles={25:false,50:false,75:false}}if(self.video_properties.full_screen)self.video_full_screen(dojo_videoElement);if(self.video_properties.play_callback)self.video_properties.play_callback()});dojo_videoElement.addEventListener("pause",function(){if(typeof self.video_properties.pause_callback=="function"){self.video_properties.pause_callback()}});dojo_videoElement.addEventListener("loadedmetadata",function(){var duration=dojo_videoElement.duration;dojo_videoElement.addEventListener("timeupdate",function(e){if(dojo_videoElement.currentTime)self.video_position=dojo_videoElement.currentTime;var check=self.roundIt(dojo_videoElement.currentTime/duration*100,0);for(var q in quartiles){if(check>=q&&!quartiles[q]){self.dojo_track({type:"video",key:"quartile"+q},true);var quartEvent=new Event("quartile"+q);dojo_videoElement.dispatchEvent(quartEvent);quartiles[q]=true}}})});var hasEnded=true;function onEnd(){if(hasEnded)return;else hasEnded=true;self.dojo_track({type:"video",key:"complete"})}dojo_videoElement.addEventListener("ended",onEnd);var videoIsMuted=false;dojo_videoElement.addEventListener("volumechange",function(){if(!videoIsMuted&&(dojo_videoElement.muted||dojo_videoElement.volume===0)){var muteEvent=new Event("muted");dojo_videoElement.dispatchEvent(muteEvent);videoIsMuted=true}else if(videoIsMuted&&!dojo_videoElement.muted&&dojo_videoElement.volume>0){var unmuteEvent=new Event("unmuted");dojo_videoElement.dispatchEvent(unmuteEvent);videoIsMuted=false}});return dojo_videoElement},video_close:function(){this.dojo_track({type:"video",key:"close"});var videoCloseEvent=new CustomEvent("videoClose",{detail:{duration:this.video_position}});dojo_videoElement.dispatchEvent(videoCloseEvent);this.vidContainer.removeChild(dojo_videoElement);this.videoPlaying=false;clearInterval(this.videoInt);if(this.video_properties.close_callback)this.video_properties.close_callback()},video_full_screen:function(elem,onEnd){var endEvent="endfullscreen";if(elem.requestFullscreen){elem.requestFullscreen()}else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen();endEvent="mozendfullscreen"}else if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen();endEvent="webkitendfullscreen"}else if(elem.msRequestFullscreen){elem.msRequestFullscreen();endEvent="msendfullscreen"}elem.addEventListener(endEvent,onEnd)},xmlToObject:function(xml,parse){if(parse){var parser=new DOMParser;xml=parser.parseFromString(xml,"text/xml")}var obj={};if(xml.nodeType==1){if(xml.attributes.length>0){obj["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);obj["@attributes"][attribute.nodeName]=attribute.nodeValue}}}else if(xml.nodeType==3){obj=xml.nodeValue}if(xml.hasChildNodes()){for(var i=0;i<xml.childNodes.length;i++){var item=xml.childNodes.item(i);var nodeName=item.nodeName;if(typeof obj[nodeName]=="undefined"){obj[nodeName]=this.xmlToObject(item,false)}else{if(typeof obj[nodeName].push=="undefined"){var old=obj[nodeName];obj[nodeName]=[];obj[nodeName].push(old)}obj[nodeName].push(this.xmlToObject(item,false))}}}return obj}};dojo.iosVersion=dojo.iosVersionCheck();if(typeof global_ad_id1!="undefined"){var newUrl=global_ad_id1[0].url.split("?");var metricsArray=newUrl[1].split("&");var metrics={};for(var i=0;i<metricsArray.length;i++){var metricParams=metricsArray[i].split("=");metrics[metricParams[0]]=decodeURIComponent(metricParams[1])}dojo.unitID=metrics.ad_id;var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){var scriptSrc=scripts[i].src;if(scriptSrc.indexOf("dojo.phluant.com")!=-1){scriptSrc=scriptSrc.replace("http://dojo.phluant.com/adj/","");scriptSrc=scriptSrc.split("/");dojo.pl=scriptSrc[0];break}}dojo.isDojo=true}function isIframe(){try{return window.self!==window.top}catch(e){return true}}function getThisFrameEl(){var frameEl=null;var i=0,iframes=window.parent.document.getElementsByTagName("iframe");while(frameEl=iframes[i++])if(frameEl.contentWindow===window)break;return frameEl}if(isIframe())dojo.iframeEl=getThisFrameEl();if(document.readyState==="complete")dojo.winLoaded=true;document.addEventListener("readystatechange",function(){if(document.readyState==="complete")dojo.winLoaded=true},false)})();